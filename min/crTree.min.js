var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}},CrTreeNodeOperation=Class.create();
CrTreeNodeOperation.prototype={icon:null,position:"before",action:null,stopEvtPropagation:!1,cssClass:null,conf:null,dom:null,node:null,defaults:{icon:null,position:"before",action:function(a){console.log(a.data.text)},stopEvtPropagation:!0,cssClass:""},initialize:function(a,b){this.node=a;this.conf=$.extend({},this.defaults,b);this.icon=this.conf.icon;this.position=this.conf.position;this.action=this.conf.action;this.stopEvtPropagation=this.conf.stopEvtPropagation;this.cssClass=this.conf.cssClass;
this._buildDom()},_buildDom:function(){var a=this,b=$('<section class="crTree-i-container '+this.position+" "+this.cssClass+'"><i class="'+this.icon+'"></i></section>');$(b).on("click",function(b){a.action&&a.action(a.node);a.stopEvtPropagation&&b.stopPropagation()});this.dom=b}};var CrTreeNode=Class.create();
CrTreeNode.prototype={tree:null,parentNode:null,drawIconNode:!0,data:null,stopEvtPropagation:!0,_domContainer:null,_dom:null,_domNode:null,_expander:null,_childrenContainer:null,_expandingCollapsing:!1,childNodes:null,_defaultHiddenClass:"crTree-hidden",cssExpanderCollapsed:"cr-icon-expander",cssExpanderExpanded:"cr-icon-expanded",animated:!0,animation:"height",animationTime:300,defaults:{id:"",expanded:!1,expandable:!1,text:"",children:null,icon:null,iconBusy:"cr-icon-busy",operations:[]},onNodeExpand:null,
onNodeCollpase:null,onNodeSelect:null,_expandedCallback:null,initialize:function(a,b,c,e){this.tree=a;this.parentNode=c;this.data=$.extend({},this.defaults,e);this._setTreeProperties();this._domContainer=b;this._buildNode(this._domContainer,this.parentNode,this.data);this.tree.registerNode(this)},select:function(){$(".crTree .cr-selected-node").removeClass("cr-selected-node");$(this._domNode).addClass("cr-selected-node");if(this.onNodeSelect)this.onNodeSelect(this)},expand:function(a){if(!this.isExpandingCollapsing()){this.setBusy();
this._expandingCollapsing=!0;this._expandedCallback=a;this.data.expanded=!this.data.expanded;if(this.data.expanded){if(this.onNodeExpand)this.onNodeExpand(this)}else if(this.onNodeCollpase)this.onNodeCollpase(this);this._expandChildrenContainer()}},addChildren:function(a){a=this._buildNodes(this._childrenContainer,this,a);this.childNodes||(this.childNodes=[]);this.childNodes=this.childNodes.concat(a)},addChildrenExpanding:function(a){this.addChildren(a);this._expandedCallback&&this._expandedCallback(this);
this.animated&&($(this._childrenContainer).css({display:"none"}),this._animate());this._expandingCollapsing=!1},hasChildren:function(){return null!=this.childNodes&&0<this.childNodes.length},isExpandingCollapsing:function(){return this._expandingCollapsing},isExpanded:function(){return this.data.expanded},isCollapsed:function(){return!this.isExpanded()},isExpandable:function(){return this.data.expandable},setBusy:function(){$(this._expander).find("i").removeClass(this.cssExpanderCollapsed);$(this._expander).find("i").removeClass(this.cssExpanderExpanded);
$(this._expander).find("i").addClass(this.data.iconBusy)},setIdle:function(){$(this._expander).find("i").removeClass(this.data.iconBusy);var a=this.cssExpanderCollapsed;this.isExpanded()&&(a=this.cssExpanderExpanded);$(this._expander).find("i").addClass(a)},_setTreeProperties:function(){var a=this.tree.getOptions();this.drawIconNode=a.drawIconNode;this.cssExpanderCollapsed=a.cssClassExpander[0];this.cssExpanderExpanded=a.cssClassExpander[1];this.animated=a.nodeAnimated;this.animation=a.nodeAnimation;
this.animationTime=a.nodeAnimationTime;this.onNodeExpand=a.onNodeExpand;this.onNodeCollpase=a.onNodeCollpase;this.onNodeSelect=a.onNodeSelect},_expandChildrenContainer:function(){this.animated?this._animate():this.data.expanded?$(this._childrenContainer).removeClass(this._defaultHiddenClass):$(this._childrenContainer).addClass(this._defaultHiddenClass);this.hasChildren()&&(this._expandedCallback&&this._expandedCallback(this),this._expandingCollapsing=!1,this.setIdle())},_animate:function(){var a=
this,b={};b[this.animation]="toggle";$(this._childrenContainer).animate(b,this.animationTime,"swing",function(){a.setIdle()})},_buildNode:function(a,b,c){c.tooltip||(c.tooltip=c.text);this._dom=$('<li title="'+c.tooltip+'"></li>');this._drawNode();this._childrenContainer=$('<ul class="'+this._defaultHiddenClass+'"></ul>');$(this._dom).append(this._childrenContainer);a&&$(a).append(this._dom);this._addNodeListener_onClick();this.data.children&&0<this.data.children.length&&this.addChildren(this.data.children);
return this},_drawNode:function(){this._domNode=$("<section></section>");$(this._dom).append(this._domNode);this._drawExpander();this._drawIcon();this._drawInnerNode()},_drawExpander:function(){var a=$('<section class="expander-container"></section>');this._expander=a;$(this._domNode).append(a);if(this.data.expandable){var b=this.cssExpanderCollapsed;this.data.expanded&&(b=this.cssExpanderExpanded);b=$("<i></i>").addClass(b);this._addExpanderListener_onClick();$(a).append(b)}},_drawIcon:function(){if(this.drawIconNode){this.data.icon||
(this.data.icon="cr-icon-folder",this.data.expandable||(this.data.icon="cr-icon-leaf"));var a=$('<section class="crTree-i-container"><i class="'+this.data.icon+'"></i></section>');$(this._domNode).append(a)}},_drawInnerNode:function(){var a=this,b=this._getBeforeOperations(),c=this._getAfterOperations(),e=$("<span>"+this.data.text+"</span>");b&&$.each(b,function(b,c){$(a._domNode).append(c.dom)});$(this._domNode).append(e);c&&$.each(c,function(b,c){$(a._domNode).append(c.dom)})},_getBeforeOperations:function(){var a=
null,b=this,c=this.data.operations;if(c){var e=[];$.each(c,function(a,b){"before"===b.position&&e.push(b)});var d=[];$.each(e,function(a,c){var e=b._createOperation(c);d.push(e)});a=d}return a},_getAfterOperations:function(){var a=null,b=this,c=this.data.operations;if(c){var e=[];$.each(c,function(a,b){"after"===b.position&&e.push(b)});var d=[];$.each(e,function(a,c){var e=b._createOperation(c);d.push(e)});a=d}return a},_createOperation:function(a){var b=null;a&&(b=new CrTreeNodeOperation(this,a));
return b},_buildNodes:function(a,b,c){var e=null;if(c&&0<c.length){var d=[],g=this.tree;$.each(c,function(c,e){var f=new CrTreeNode(g,a,b,e);d.push(f)});e=d}return e},_addNodeListener_onClick:function(){var a=this;$(this._domNode).on("click",function(b){a.select();a.stopEvtPropagation&&b.stopPropagation()})},_addExpanderListener_onClick:function(){var a=this;$(this._expander).on("click",function(b){a.expand();b.stopPropagation()})}};
(function(a){function b(){a(g).empty();k=a(g).addClass("crTree").append("<ul></ul>").css({height:d.height,width:d.width}).find("ul")}function c(b,c,d){var m=[];d&&0<d.length&&a.each(d,function(a,d){var f=e(b,c,d);m.push(f)});return m}function e(b,c,d){new CrTreeNode(a(this).CrTree,b,c,d)}var d={},g={},k=null,l=null,f=null,h=null;a.fn.CrTree=function(e){d=a.extend({},a.fn.CrTree.defaults,e);f=[];h=[];return this.each(function(){g=a(this);b();l=c(k,null,d.children);if(d.onTreeCompleted)d.onTreeCompleted()})};
a.extend(a.fn.CrTree,{findItem:function(a,b){var c=null;if(b&&"id"!==b)for(var d=0,e=f.length;d<e;){var g=f[d];g.data[b]===a&&(c=g);d++}else if(h){var d=h.indexOf(a);-1!=d&&(c=f[d])}return c},expandItem:function(a,b){a&&a.expand(b)},selectItem:function(a){a&&a.select()},setRoot:function(a){b();l=c(k,a)},getRoot:function(){return l},getOptions:function(){return d},registerNode:function(a){f.push(a);h.push(a.data.id)},getNodes:function(){return f}});a.fn.CrTree.defaults={children:null,height:"300px",
width:"200px",stopEvtPropagation:!0,onNodeSelect:null,onNodeExpand:null,onNodeCollpase:null,onNodeChildrenAdded:null,onNodeExpanded:null,onTreeCompleted:null,drawIconNode:!0,cssClassExpander:["cr-icon-expander","cr-icon-expanded"],nodeAnimated:!0,nodeAnimation:"height",nodeAnimationTime:300}})(jQuery);
